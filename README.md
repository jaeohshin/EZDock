# Evaluation [Work in Progress]
This is the evaluation branch, where the molecules generated by the diffusion model is evaluated.

Currently, I am working on docking, which you can see in the [docking](https://github.com/meyresearch/SILVR2/tree/evaluation/docking) directory of this repository.

In the future, I will continue working on other evaluation metrics:

1. **Similarity scores** between the input and output molecules:
    - Tanimoto similarity score
    - Max Common Substructure (MCS)
2. **Quantitative Estimate of Druglikeness (QED)** of the generated molecules
3. **Synthetic Accessibility Score (SAscore)** of the generated molecules
4. **Consensus Scoring** using OpenEyeTools
    - Shapegauss
    - Chemgauss4
    - Chemscore

## The AutoDock Vina Pipeline [Robustness Testing WIP]

Work has been carried out to build a docking pipeline as part of evaluation for SILVR2. This is so that we can evaluate how well the molecules generated by SILVR2 bind to the active site of the protein of interest. We call this ability to bind 'Binding Affinity'.

One way to measure protein-ligand binding affinity, is through a heuristic algorithmm, molecular docking, where the protein is held static, and the ligand is freely rotating within the protein binding pocket.

There are many docking software available, each with different performances. In our study, we will use [AutoDock Vina](https://github.com/ccsb-scripps/AutoDock-Vina), an open-source docking software, and [OEDocking Toolkit](https://docs.eyesopen.com/toolkits/python/dockingtk/index.html) from the [OpenEye Toolkits](https://docs.eyesopen.com/toolkits/python/kitsummarypcpp.html) for docking purposes.

### Notebook file:

See jupyter notebook [``step_1_docking.ipynb``](https://github.com/meyresearch/SILVR2/blob/evaluation/docking/step_1_docking.ipynb) for more details.

### Process overview:

- **Input:** PDB ID that contains a protein-ligand complex
- **Process:** Download PDB files --> Protein and ligand file separation --> Protein and ligand file preparation --> Docking and scoring --> Data storage
- **Output:** AutoDock Vina output log, CSV file containing free energy of binding score

### Major steps involved:

1. **Setting Environment:** Installing and importing necessary modules and packages, setting environments, and giving permissions to scripts and license.

2. **Download PDB File:** Read a lit of PDB IDs and download the PDB file to the current directory using the ``PDBList`` module from Biopython. Each PDB file should contain a protein-ligand complex, with the ligand already in the active site of the protein. If there is no ligand or the ligand is far away from its active site, then the pipeline may not work as expected.

3. **Ligand Extraction:** Ligand extraction from a PDB file, using the ``OEWriteMolecule`` function from  the ``OEChem Toolkits``. This process first converts the PDB to an OpenEye Design Unit before writing out the ligand in PDB format.

4. **Protein Extraction:** Receptor (protein) extraction using a customisable ``PDBIO`` Biopython module, which excludes heteroatoms and water. This writes out the receptor in PDB format.

5. **Docking Search Grid Definition** *(Included in the python script but not yet used)***:** Cneter of Mass (COM) and Center of Geometry (COG) calculation for the ligand. This is usually used for defining a docking search grid but since the ligand is assumed to be contained in the active site and we want a ``score-only`` vina process using the ``--autobox`` flag within vina.

6. **Docking File Preparation:** Ligand and protein file preparation of the extracted PDB ligand and receptor. This step is for AutoDock Vina, and it saves the prepped files in PDBQT format using the ``prepare_receptor`` and ``prepare_ligand`` functions from the [ADFRsuite](https://ccsb.scripps.edu/adfr/documentation/).

7. **AutoDock Vina Scoring:** Scoring using Autodock Vina, using the ``--autobox`` and the ``--score-only`` flags. This means that no ligand poses are returned, which significantly reduces runtime. An output log is saved in OUT format, and the free energy (dG) calculated is passed onto the next step to save to a CSV file and for further processing.

8. **Data Storage:** The dG score obtained is written to a CSV file under the 'computed_dG' column under the PDB ID label. Extra information (ligand SMILES, protein sequence and experimental binding affinity) are also extracted from ``leaky_pdb.csv`` and included in the CSV file. The user can choose to extract information from whichever dataset they want.

    In the future, a more streamlined approach would be better in case the input PDB ID isn't in the leakyPDB dataset.

    The pipeline has error traps implemented through all steps and these are recorded in the CSV file.

9. **File Management:** All data are moved to the ``data/{first_pdb_id}_to_{last_pdb_id}/{pdb_id}`` directory except the CSV file, which continuously collects data in the current directory.

### Testing the pipeline

To test the robustness of this pipeline, we use the PDB IDs from LeakyPDB to obtain some free energy of binding results. The pipeline has error traps set up to capture and record any error encountered during the experiment. We will inspect the output files to investigate any causes of failure and seek to improve the pipeline this way.

### Electronic Lab Notebook (ELN)

I keep an detailed, active log of activities I've been up to with this repo in the folder [``ELN``](https://github.com/meyresearch/SILVR2/tree/evaluation/ELN) as supplementary information, though all relevant information will be updated to this README document. Feel free to check them out!